<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø´Ø±ÙˆØ¹ Ù„Ø­ÙˆÙ… Ø§Ù„Ø±ÙŠØ§Ø¶ - Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <style>
    :root {
      --color-background: #FCFCF9;
      --color-surface: #FFFFFD;
      --color-text: #13343B;
      --color-primary: #21808D;
      --color-primary-hover: #1D7480;
      --color-error: #C0152F;
      --color-success: #2FB5A3;
      --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
        BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, #F0F8F9 0%, #E8F5F7 100%);
      color: var(--color-text);
      font-family: var(--font-family-base);
      direction: rtl;
      padding: 16px;
    }
    .navbar {
      background: var(--color-primary);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(33,128,141,0.2);
      flex-wrap: wrap;
      gap: 12px;
    }
    .navbar h1 {
      margin: 0;
      font-size: 24px;
    }
    .nav-buttons {
      display: flex;
      gap: 8px;
    }
    .nav-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .nav-btn:hover, .nav-btn.active {
      background: white;
      color: var(--color-primary);
    }
    .container {
      max-width: 640px;
      margin: 0 auto;
    }
    .card {
      background: var(--color-surface);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(33,128,141,0.07);
      padding: 32px 24px;
      border: 1px solid #E0E0E0;
      margin-bottom: 24px;
    }
    h2 {
      margin: 0 0 18px 0;
      color: var(--color-primary);
      font-weight: 600;
      font-size: 20px;
    }
    .form-section {
      margin-bottom: 18px;
    }
    label {
      font-weight: 500;
      margin-bottom: 4px;
      display: block;
    }
    select, input, textarea {
      font-family: inherit;
      font-size: 16px;
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #CDD6DA;
      margin-bottom: 8px;
      background: var(--color-background);
      transition: border 0.2s;
    }
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 4px rgba(33,128,141,0.16);
    }
    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .half {
      flex: 1;
    }
    .map-link, .whatsapp-link {
      background: var(--color-primary);
      color: white;
      border-radius: 7px;
      padding: 8px 12px;
      font-size: 14px;
      text-align: center;
      display: inline-block;
      text-decoration: none;
      margin: 4px 4px 12px 0;
      transition: background 0.2s;
      border: none;
      cursor: pointer;
    }
    .map-link:hover, .whatsapp-link:hover {
      background: var(--color-primary-hover);
    }
    .button-main {
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 11px 28px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 6px;
      transition: background 0.16s;
      width: 100%;
    }
    .button-main:hover {
      background: var(--color-primary-hover);
    }
    .total-box {
      background: linear-gradient(135deg, #F7F9F9 0%, #E8F5F7 100%);
      border-radius: 8px;
      padding: 12px 16px;
      color: var(--color-primary);
      font-weight: 600;
      margin-bottom: 12px;
      font-size: 16px;
      border: 2px solid var(--color-primary);
    }
    .breakdown {
      font-size: 13px;
      line-height: 1.8;
      margin-bottom: 8px;
    }
    .error {
      color: var(--color-error);
      margin-bottom: 12px;
      font-size: 14px;
      text-align: center;
    }
    .success {
      color: var(--color-success);
      font-size: 15px;
      background: #EAF9FB;
      border-radius: 8px;
      padding: 10px;
      font-weight: 500;
      margin: 10px 0;
      border-left: 4px solid var(--color-success);
    }
    .order-item {
      background: #F7F9F9;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      border-left: 4px solid var(--color-primary);
      font-size: 13px;
    }
    .order-item-header {
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 6px;
    }
    .hidden {
      display: none;
    }
    .action-buttons {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .btn-small {
      background: #E8F5F7;
      color: var(--color-primary);
      border: 1px solid var(--color-primary);
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      flex: 1;
      text-align: center;
    }
    .btn-small:hover {
      background: var(--color-primary);
      color: white;
    }
    footer {
      text-align: center;
      color: #7d888c;
      font-size: 14px;
      margin-top: 30px;
      padding-bottom: 20px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    .stat-card {
      background: #F0F8F9;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #E0E0E0;
    }
    .stat-value {
      font-size: 20px;
      font-weight: 600;
      color: var(--color-primary);
    }
    .stat-label {
      font-size: 12px;
      color: #7d888c;
      margin-top: 4px;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
    }
    .status-pending {
      background: #FFE8CC;
      color: #D97706;
    }
    .status-processing {
      background: #D1E7F5;
      color: #0369A1;
    }
    .status-delivered {
      background: #D1F4E7;
      color: #047857;
    }
    .status-cancelled {
      background: #FED7D7;
      color: #C0152F;
    }
    .status-buttons {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .status-btn {
      background: #E8F5F7;
      color: var(--color-primary);
      border: 1px solid var(--color-primary);
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }
    .status-btn:hover {
      background: var(--color-primary);
      color: white;
    }
    .status-btn.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary-hover);
    }
    @media(max-width:600px){
      .card { padding: 16px 12px; }
      .navbar { flex-direction: column; text-align: center; }
    }
        .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #16a34a;
      color: white;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>ğŸ– Ù„Ø­ÙˆÙ… Ø§Ù„Ø±ÙŠØ§Ø¶</h1>
    <div class="nav-buttons">
      <button class="nav-btn active" onclick="switchTab('order')">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      <button class="nav-btn" onclick="switchTab('history')">Ø·Ù„Ø¨Ø§ØªÙŠ</button>
      <button class="nav-btn" onclick="clearAllOrders()" style="background:#C0152F;">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
    </div>
  </div>

  <div class="container">
    <!-- Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨: Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <div id="orderTab">
      <div class="card">
        <h2>ğŸ”¸ Ø§Ø·Ù„Ø¨ Ù…Ø§Ø´ÙŠØªÙƒ Ø§Ù„Ø¢Ù†</h2>
        <form id="orderForm">
          <div class="form-section">
            <label for="animal">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø´ÙŠØ©</label>
            <select id="animal" required>
              <option value="" selected disabled>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø´ÙŠØ©</option>
              <option value="ØºÙ†Ù…">ØºÙ†Ù… (1050 Ø±.Ø³)</option>
              <option value="Ù†Ø¹ÙŠÙ…ÙŠ">Ù†Ø¹ÙŠÙ…ÙŠ (1250 Ø±.Ø³)</option>
              <option value="Ø³ÙˆØ§ÙƒÙ†ÙŠ">Ø³ÙˆØ§ÙƒÙ†ÙŠ (950 Ø±.Ø³)</option>
              <option value="Ù…Ø§ØºÙ†Ùˆ">Ù…Ø§ØºÙ†Ùˆ (980 Ø±.Ø³)</option>
              <option value="Ø¬Ø¯ÙŠ">Ø¬Ø¯ÙŠ (830 Ø±.Ø³)</option>
              <option value="Ø¹Ø¬Ù„">Ø¹Ø¬Ù„ (6800 Ø±.Ø³)</option>
              <option value="Ø­Ø§Ø´ÙŠ">Ø­Ø§Ø´ÙŠ (3900 Ø±.Ø³)</option>
            </select>
          </div>
          <div class="form-section row">
            <div class="half">
              <label for="service">Ø®Ø¯Ù…Ø© Ø§Ù„Ø°Ø¨Ø­</label>
              <select id="service" required>
                <option value="Ù…Ø°Ø¨ÙˆØ­ ÙˆÙ…Ù‚Ø·Ø¹ ÙˆÙ…ØºÙ„Ù">Ø°Ø¨Ø­+ØªÙ‚Ø·ÙŠØ¹+ØªØºÙ„ÙŠÙ (+120)</option>
                <option value="Ù…Ø°Ø¨ÙˆØ­ ÙÙ‚Ø·">Ø°Ø¨Ø­ ÙÙ‚Ø· (+60)</option>
                <option value="Ù…Ø°Ø¨ÙˆØ­ ÙˆÙ…Ù‚Ø·Ø¹">Ø°Ø¨Ø­+ØªÙ‚Ø·ÙŠØ¹ (+95)</option>
                <option value="Ø¨Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø©">Ø¨Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø©</option>
              </select>
            </div>
            <div class="half">
              <label for="delivery">Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</label>
              <select id="delivery" required>
                <option value="ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„">ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ (+50)</option>
                <option value="Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
              </select>
            </div>
          </div>
          <div class="form-section row">
            <div class="half">
              <label for="quantity">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
              <input type="number" id="quantity" value="1" min="1" max="10" required />
            </div>
            <div class="half">
              <label for="cutting">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ‚Ø·ÙŠØ¹</label>
              <select id="cutting">
                <option value="Ø£Ø¬Ø²Ø§Ø¡ ÙƒØ¨ÙŠØ±Ø©">Ø£Ø¬Ø²Ø§Ø¡ ÙƒØ¨ÙŠØ±Ø©</option>
                <option value="Ø£Ø¬Ø²Ø§Ø¡ ØµØºÙŠØ±Ø©">Ø£Ø¬Ø²Ø§Ø¡ ØµØºÙŠØ±Ø©</option>
                <option value="ØªÙ‚Ø·ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨">ØªÙ‚Ø·ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨</option>
              </select>
            </div>
          </div>
          <div class="form-section">
            <label for="location">Ù…ÙˆÙ‚Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</label>
            <input type="text" id="location" placeholder="Ù…Ø«Ø§Ù„: Riyadh, Saudi Arabia" required>
            <a href="https://maps.google.com/" target="_blank" rel="noopener noreferrer" class="map-link">ğŸ“ ÙØªØ­ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</a>
          </div>
          <div class="form-section">
            <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù„Ù„ØªÙˆØ§ØµÙ„)</label>
            <input type="tel" id="phone" placeholder="05xxxxxxxxx" required>
          </div>
          <div class="form-section">
            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ©</label>
            <textarea id="notes" rows="2" placeholder="Ù…Ø«Ø§Ù„: ØªØ¬Ù†Ø¨ Ø§Ù„Ø±Ø£Ø³ Ø£Ùˆ ÙƒÙ…ÙŠØ© Ø´Ø­Ù… Ø£Ù‚Ù„..."></textarea>
          </div>
          <button type="button" class="button-main" onclick="calcTotal()">Ø§Ø­Ø³Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©</button>
          <div class="total-box hidden" id="outputCost"></div>
          <div class="error hidden" id="errMsg"></div>
          <div id="paymentSection" class="hidden">
            <div class="form-section">
              <label for="payMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</label>
              <select id="payMethod">
                <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                <option value="Apple Pay">Apple Pay</option>
                <option value="STCPay">STC Pay</option>
              </select>
            </div>
            <button type="button" class="whatsapp-link" id="whatsappBtn" onclick="openWhatsApp()">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp</button>
            <button type="submit" class="button-main">âœ“ ØªØ£ÙƒÙŠØ¯ ÙˆØ­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
          </div>
          <div class="success hidden" id="successMsg"></div>
        </form>
      </div>
    </div>

    <!-- Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨: Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div id="historyTab" class="hidden">
      <div class="card">
        <h2>ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="totalOrders">0</div>
            <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalSpent">0</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="pendingCount">0</div>
            <div class="stat-label">â³ Ù…Ø¹Ù„Ù‘Ù‚</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="processingCount">0</div>
            <div class="stat-label">âš™ï¸ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="deliveredCount">0</div>
            <div class="stat-label">ğŸšš ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="cancelledCount">0</div>
            <div class="stat-label">âŒ Ù…Ù„ØºÙ‰</div>
          </div>
        </div>
        <div id="ordersList"></div>
      </div>
    </div>
  </div>

  <footer>
    âœ¨ Ø®Ø¯Ù…Ø© ØªØ¬Ø±Ø¨Ø© - Ø¨Ø¯ÙˆÙ† Ø¯ÙØ¹ Ø­Ù‚ÙŠÙ‚ÙŠ | Ù…ØªØ§Ø­Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ ÙÙ‚Ø·<br>
    Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate"></span>
  </footer>

  <script>
    const WHATSAPP_NUMBER = "966501234567"; // Ø±Ù‚Ù… WhatsApp ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ©)
    
    const prices = {
      "ØºÙ†Ù…": 1050, "Ù†Ø¹ÙŠÙ…ÙŠ": 1250, "Ø³ÙˆØ§ÙƒÙ†ÙŠ": 950, "Ù…Ø§ØºÙ†Ùˆ": 980,
      "Ø¬Ø¯ÙŠ": 830, "Ø¹Ø¬Ù„": 6800, "Ø­Ø§Ø´ÙŠ": 3900
    };
    
    const butcherCost = {
      "Ù…Ø°Ø¨ÙˆØ­ ÙÙ‚Ø·": 60, "Ù…Ø°Ø¨ÙˆØ­ ÙˆÙ…Ù‚Ø·Ø¹": 95,
      "Ù…Ø°Ø¨ÙˆØ­ ÙˆÙ…Ù‚Ø·Ø¹ ÙˆÙ…ØºÙ„Ù": 120, "Ø¨Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø©": 0
    };
    
    const deliveryCost = {
      "ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„": 50, "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹": 0
    };

    function switchTab(tab) {
      document.getElementById('orderTab').classList.toggle('hidden', tab !== 'order');
      document.getElementById('historyTab').classList.toggle('hidden', tab !== 'history');
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      if (tab === 'history') loadOrders();
    }

    function calcTotal() {
      clearMessages();
      const animal = document.getElementById('animal').value;
      const service = document.getElementById('service').value;
      const delivery = document.getElementById('delivery').value;
      const quantity = parseInt(document.getElementById('quantity').value, 10);

      if (!animal || !service || !delivery || !quantity || quantity < 1) {
        showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      const baseCost = prices[animal] * quantity;
      const butcher = butcherCost[service] * quantity;
      const delivFee = deliveryCost[delivery];
      const total = baseCost + butcher + delivFee;

      const breakdown = `<div class="breakdown">
        Ø³Ø¹Ø± Ø§Ù„Ù…Ø§Ø´ÙŠØ©: ${prices[animal]} Ã— ${quantity} = ${baseCost} Ø±.Ø³<br>
        Ø®Ø¯Ù…Ø© Ø§Ù„Ø°Ø¨Ø­/Ø§Ù„ØªÙ‚Ø·ÙŠØ¹: ${butcherCost[service]} Ã— ${quantity} = ${butcher} Ø±.Ø³<br>
        Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„: ${delivFee} Ø±.Ø³<br>
        <strong style="color: var(--color-primary); font-size: 18px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total} Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</strong>
      </div>`;

      document.getElementById('outputCost').innerHTML = breakdown;
      document.getElementById('outputCost').classList.remove('hidden');
      document.getElementById('paymentSection').classList.remove('hidden');
    }

    function openWhatsApp() {
      const animal = document.getElementById('animal').value;
      const service = document.getElementById('service').value;
      const quantity = document.getElementById('quantity').value;
      const delivery = document.getElementById('delivery').value;
      const phone = document.getElementById('phone').value;

      if (!animal || !service || !quantity || !delivery || !phone) {
        showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      const baseCost = prices[animal] * quantity;
      const butcher = butcherCost[service] * quantity;
      const delivFee = deliveryCost[delivery];
      const total = baseCost + butcher + delivFee;

      const msg = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø·Ù„Ø¨:\n- Ø§Ù„Ù…Ø§Ø´ÙŠØ©: ${animal}\n- Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}\n- Ø§Ù„Ø®Ø¯Ù…Ø©: ${service}\n- Ø§Ù„ØªÙˆØµÙŠÙ„: ${delivery}\n- Ø±Ù‚Ù…ÙŠ: ${phone}\n- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„\n\nØ´ÙƒØ±Ø§Ù‹`;
      const encodedMsg = encodeURIComponent(msg);
      const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMsg}`;
      window.open(whatsappURL, '_blank');
    }

    function clearMessages() {
      document.getElementById('errMsg').classList.add('hidden');
      document.getElementById('successMsg').classList.add('hidden');
    }

    function showError(msg) {
      const errDiv = document.getElementById('errMsg');
      errDiv.textContent = msg;
      errDiv.classList.remove('hidden');
    }

    function showSuccess(msg) {
      const sucDiv = document.getElementById('successMsg');
      sucDiv.textContent = msg;
      sucDiv.classList.remove('hidden');
    }
        function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    document.getElementById('orderForm').onsubmit = function(e) {
      e.preventDefault();
      clearMessages();

      const animal = document.getElementById('animal').value;
      const service = document.getElementById('service').value;
      const delivery = document.getElementById('delivery').value;
      const quantity = parseInt(document.getElementById('quantity').value, 10);
      const location = document.getElementById('location').value.trim();
      const phone = document.getElementById('phone').value.trim();

      if (!animal || !service || !delivery || !quantity || quantity < 1 || !location || !phone) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
        return;
      }

      const baseCost = prices[animal] * quantity;
      const butcher = butcherCost[service] * quantity;
      const delivFee = deliveryCost[delivery];
      const total = baseCost + butcher + delivFee;

      const order = {
        id: Date.now(),
        date: new Date().toLocaleString('ar-SA'),
        animal, service, delivery, quantity, location, phone,
        cutting: document.getElementById('cutting').value,
        notes: document.getElementById('notes').value,
        payMethod: document.getElementById('payMethod').value,
        total,
        status: "Ù…Ø¹Ù„Ù‚",
        statusUpdatedAt: new Date().toLocaleString('ar-SA')
      };

      let orders = JSON.parse(localStorage.getItem('meatOrders')) || [];
      orders.push(order);
      localStorage.setItem('meatOrders', JSON.stringify(orders));

      showSuccess(`âœ… ØªÙ… Ø­ÙØ¸ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!\nØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${order.id}\nØ§Ù„Ù…Ø¨Ù„Øº: ${total} Ø±ÙŠØ§Ù„\nØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: ${phone}`);
      document.getElementById('orderForm').reset();
      document.getElementById('paymentSection').classList.add('hidden');
      document.getElementById('outputCost').classList.add('hidden');
      document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ar-SA');
    };

    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem('meatOrders')) || [];
      const ordersList = document.getElementById('ordersList');
      const totalOrders = document.getElementById('totalOrders');
      const totalSpent = document.getElementById('totalSpent');

      const total = orders.length;
      const totalAmount = orders.reduce((sum, o) => sum + o.total, 0);

      const pending = orders.filter(o => o.status === 'Ù…Ø¹Ù„Ù‚').length;
      const processing = orders.filter(o => o.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±').length;
      const delivered = orders.filter(o => o.status === 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„').length;
      const cancelled = orders.filter(o => o.status === 'Ù…Ù„ØºÙ‰').length;

      totalOrders.textContent = total.toLocaleString('ar-SA');
      totalSpent.textContent = totalAmount.toLocaleString('ar-SA') + ' Ø±.Ø³';

      document.getElementById('pendingCount').textContent = pending.toLocaleString('ar-SA');
      document.getElementById('processingCount').textContent = processing.toLocaleString('ar-SA');
      document.getElementById('deliveredCount').textContent = delivered.toLocaleString('ar-SA');
      document.getElementById('cancelledCount').textContent = cancelled.toLocaleString('ar-SA');

      if (orders.length === 0) {
        ordersList.innerHTML = '<p style="text-align: center; color: #7d888c;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>';
        return;
      }

      const getStatusInfo = (status) => {
        const statusMap = {
          "Ù…Ø¹Ù„Ù‚": { class: "status-pending", icon: "â³" },
          "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±": { class: "status-processing", icon: "âš™ï¸" },
          "ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„": { class: "status-delivered", icon: "ğŸšš" },
          "Ù…Ù„ØºÙ‰": { class: "status-cancelled", icon: "âŒ" }
        };
        return statusMap[status] || statusMap["Ù…Ø¹Ù„Ù‚"];
      };

      ordersList.innerHTML = orders.reverse().map(o => {
        const statusInfo = getStatusInfo(o.status);
        return `
        <div class="order-item">
          <div class="order-item-header">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù…: ${o.id}
            <span class="status-badge ${statusInfo.class}">${statusInfo.icon} ${o.status}</span>
          </div>
          <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${o.date}</div>
          <div><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø­Ø§Ù„Ø©:</strong> ${o.statusUpdatedAt || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ù…Ø§Ø´ÙŠØ©:</strong> ${o.animal} (Ø§Ù„ÙƒÙ…ÙŠØ©: ${o.quantity})</div>
          <div><strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${o.service}</div>
          <div><strong>Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${o.delivery}</div>
          <div><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${o.location}</div>
          <div><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${o.phone}</div>
          <div style="color: var(--color-primary); font-weight: 600;">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${o.total} Ø±ÙŠØ§Ù„</div>
          <div class="status-buttons">
            <button class="status-btn ${o.status === 'Ù…Ø¹Ù„Ù‚' ? 'active' : ''}" onclick="updateOrderStatus(${o.id}, 'Ù…Ø¹Ù„Ù‚')">Ù…Ø¹Ù„Ù‚</button>
            <button class="status-btn ${o.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±' ? 'active' : ''}" onclick="updateOrderStatus(${o.id}, 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±')">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
            <button class="status-btn ${o.status === 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„' ? 'active' : ''}" onclick="updateOrderStatus(${o.id}, 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„')">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</button>
            <button class="status-btn" style="border-color: var(--color-error); color: var(--color-error);" onclick="updateOrderStatus(${o.id}, 'Ù…Ù„ØºÙ‰')">Ù…Ù„ØºÙ‰</button>
          </div>
          <div class="action-buttons">
            <button class="btn-small" onclick="copyOrderDetails(${o.id})">Ù†Ø³Ø® Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
            <button class="btn-small" onclick="deleteOrder(${o.id})" style="border-color: var(--color-error); color: var(--color-error);">Ø­Ø°Ù</button>
          </div>
        </div>
      `;
      }).join('');
    }

    function copyOrderDetails(orderId) {
      const orders = JSON.parse(localStorage.getItem('meatOrders')) || [];
      const order = orders.find(o => o.id === orderId);
      if (!order) return;

      const text = `Ø·Ù„Ø¨ Ø±Ù‚Ù…: ${order.id}\nØ§Ù„Ù…Ø§Ø´ÙŠØ©: ${order.animal}\nØ§Ù„ÙƒÙ…ÙŠØ©: ${order.quantity}\nØ§Ù„Ø®Ø¯Ù…Ø©: ${order.service}\nØ§Ù„ØªÙˆØµÙŠÙ„: ${order.delivery}\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${order.location}\nØ§Ù„Ø±Ù‚Ù…: ${order.phone}\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±ÙŠØ§Ù„`;
      navigator.clipboard.writeText(text).then(() => alert('âœ“ ØªÙ… Ù†Ø³Ø® ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨'));
    }

    function deleteOrder(orderId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
      let orders = JSON.parse(localStorage.getItem('meatOrders')) || [];
      orders = orders.filter(o => o.id !== orderId);
      localStorage.setItem('meatOrders', JSON.stringify(orders));
      loadOrders();
    }

    function updateOrderStatus(orderId, newStatus) {
      let orders = JSON.parse(localStorage.getItem('meatOrders')) || [];
      const order = orders.find(o => o.id === orderId);
      if (!order) return;
      
      order.status = newStatus;
      order.statusUpdatedAt = new Date().toLocaleString('ar-SA');
      localStorage.setItem('meatOrders', JSON.stringify(orders));
      loadOrders();
      showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰: ${newStatus}`);
    }

    function clearAllOrders() {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ Ù‡Ø°Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) return;
      localStorage.removeItem('meatOrders');
      alert('âœ“ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª');
      loadOrders();
    }

    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ar-SA');
  </script>
  <div id="toast" class="toast"></div>
</body>
</html>
